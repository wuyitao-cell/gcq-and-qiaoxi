<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>拱宸桥周边景点地图 - 高精度坐标</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            height: 100%;
            background-color: #f5f5f5;
        }
        
        .container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        header {
            background: linear-gradient(135deg, #1a6dcc 0%, #2c8ae6 100%);
            color: white;
            padding: 15px 20px;
            flex-shrink: 0;
        }
        
        h1 {
            margin: 0;
            font-size: 22px;
        }
        
        .subtitle {
            margin: 5px 0 0;
            font-size: 13px;
            opacity: 0.9;
        }
        
        .content {
            display: flex;
            flex: 1;
            min-height: 0;
        }
        
        #map {
            flex: 3;
            min-height: 400px;
        }
        
        .sidebar {
            flex: 1;
            min-width: 300px;
            max-width: 350px;
            border-left: 1px solid #eee;
            overflow-y: auto;
            padding: 15px;
            background-color: #f9f9f9;
            display: flex;
            flex-direction: column;
        }
        
        .controls {
            padding: 10px;
            background-color: #f0f7ff;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            flex-shrink: 0;
        }
        
        .control-btn {
            padding: 6px 12px;
            background-color: #2c8ae6;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: background-color 0.2s;
        }
        
        .control-btn:hover {
            background-color: #1a6dcc;
        }
        
        .search-box {
            flex: 1;
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
            min-width: 150px;
        }
        
        .info-window {
            max-width: 250px;
            padding: 5px;
        }
        
        .info-title {
            font-weight: bold;
            color: #1a6dcc;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .info-coords {
            font-size: 11px;
            color: #666;
            margin-bottom: 8px;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
            padding: 8px;
            background-color: #f9f9f9;
            border-radius: 4px;
            flex-shrink: 0;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            font-size: 11px;
            margin-right: 12px;
        }
        
        .legend-color {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 4px;
        }
        
        .statistics {
            margin-top: 10px;
            font-size: 12px;
            color: #666;
            padding: 6px;
            background-color: #f0f7ff;
            border-radius: 4px;
            flex-shrink: 0;
        }
        
        .sidebar-item {
            padding: 8px;
            margin-bottom: 6px;
            border-left: 4px solid #06D6A0;
            background-color: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        #list {
            flex: 1;
            overflow-y: auto;
        }
        
        .coordinate-display {
            font-family: monospace;
            font-size: 11px;
            color: #666;
            background-color: #f5f5f5;
            padding: 2px 4px;
            border-radius: 3px;
            margin-top: 3px;
        }
        
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            
            .sidebar {
                max-width: 100%;
                border-left: none;
                border-top: 1px solid #eee;
                max-height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>拱宸桥周边景点地图 - 高精度坐标</h1>
            <p class="subtitle">72个景点，使用原始高精度坐标</p>
        </header>
        
        <div class="controls">
            <input type="text" id="searchInput" class="search-box" placeholder="搜索景点名称...">
            <button id="resetView" class="control-btn">重置视图</button>
            <button id="showAllMarkers" class="control-btn">显示所有景点</button>
            <button id="adjustPrecision" class="control-btn">调整坐标精度</button>
            <button id="exportData" class="control-btn">导出数据</button>
        </div>
        
        <div class="content">
            <div id="map"></div>
            <div class="sidebar">
                <h3 style="margin-top: 0; margin-bottom: 10px;">景点列表 (共<span id="count">72</span>个)</h3>
                <div id="list"></div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #FF6B6B;"></div>
                        <span>核心景点</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #4ECDC4;"></div>
                        <span>博物馆/展览馆</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #FFD166;"></div>
                        <span>手工艺/非遗</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #9D7BEF;"></div>
                        <span>茶馆/书店</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #06D6A0;"></div>
                        <span>其他景点</span>
                    </div>
                </div>
                <div class="statistics" id="stats">
                    提示：点击地图上的标记点或侧边栏列表查看详情
                </div>
            </div>
        </div>
    </div>

    <!-- 使用高德地图API - 已集成您的API Key -->
    <script src="https://webapi.amap.com/maps?v=2.0&key=8fc6ff68e10147a2508a5a2c92cf23e8"></script>
    <script>
        // 景点数据 - 72个景点，使用原始高精度坐标
        const attractions = [
            {name: "拱宸桥", coords: [120.13988562572624, 30.31812719432141]},
            {name: "拱宸桥凉亭", coords: [120.13989859055812, 30.318183239176097]},
            {name: "大运河介绍石碑", coords: [120.13897279351812, 30.318297162008015]},
            {name: "方回春堂", coords: [120.13869686572895, 30.318275924826274]},
            {name: "朱炳仁·铜", coords: [120.13809878311604, 30.318345850497288]},
            {name: "桥西历史文化街区雕塑", coords: [120.1369666230571, 30.31866570696237]},
            {name: "中心集施茶材会公所旧址", coords: [120.13788975377213, 30.317889823298934]},
            {name: "少年陈鹤琴寄寓拱辰", coords: [120.1382398023801, 30.317238865986617]},
            {name: "财神庙", coords: [120.13831081214414, 30.31698087435013]},
            {name: "晓风书屋", coords: [120.13860785312768, 30.317025911361434]},
            {name: "杭州水文水资源科普展厅", coords: [120.13876187425227, 30.317071930482737]},
            {name: "仝仺美学馆", coords: [120.13871386780896, 30.31747792535676]},
            {name: "仁德堂", coords: [120.13879266363688, 30.31762704022377]},
            {name: "张大仙庙", coords: [120.13869786576676, 30.31795792432417]},
            {name: "大运河国医馆", coords: [120.1386748625444, 30.317734921043442]},
            {name: "利泽千秋/南北通津", coords: [120.14002404413999, 30.31815008560323]},
            {name: "张小泉锻剪", coords: [120.13866297180114, 30.318948108058763]},
            {name: "织布", coords: [120.13877549350661, 30.319096241662383]},
            {name: "油纸伞", coords: [120.13866417072686, 30.31895216678639]},
            {name: "过江布", coords: [120.13801750492914, 30.319054964286835]},
            {name: "纸艺", coords: [120.13865203376145, 30.3189483433785]},
            {name: "陶艺", coords: [120.13879963379453, 30.31897891667804]},
            {name: "皮雕", coords: [120.13880132883563, 30.318522144821547]},
            {name: "木艺", coords: [120.13864999540915, 30.31901812174422]},
            {name: "彩泥塑", coords: [120.13871403613635, 30.318947226852913]},
            {name: "冷瓷", coords: [120.13863163421435, 30.318951723158257]},
            {name: "糕点制作", coords: [120.13864239895659, 30.318941010094186]},
            {name: "中国扇博物馆", coords: [120.13870186779978, 30.318977047069072]},
            {name: "手工艺活态馆入口", coords: [120.13867028973637, 30.31894547486074]},
            {name: "制香", coords: [120.13861107241897, 30.31882914846364]},
            {name: "杭绣", coords: [120.13852588901617, 30.318982882312998]},
            {name: "篆刻", coords: [120.13865419107506, 30.318957141380295]},
            {name: "运河文创", coords: [120.13868590659708, 30.31898406930669]},
            {name: "手工艺活态馆出口", coords: [120.13874077591677, 30.318991997101627]},
            {name: "语自在·老杭州民宿", coords: [120.13818471229347, 30.316940692346627]},
            {name: "同和里民国土墙", coords: [120.13840554966399, 30.31683670040112]},
            {name: "目茶馆", coords: [120.13843216912153, 30.314941875319974]},
            {name: "拱宸桥旅游码头", coords: [120.1379094110703, 30.314938564766067]},
            {name: "大运河数字影像馆", coords: [120.1383992056834, 30.314810810147485]},
            {name: "中国杭州工艺美术博物馆", coords: [120.13817081843959, 30.315768339725423]},
            {name: "中国伞博物馆", coords: [120.13808360765174, 30.315792407331855]},
            {name: "中国刀剪剑博物馆", coords: [120.13817423614285, 30.316053814122764]},
            {name: "觅会茶馆", coords: [120.13881973821665, 30.317489431840187]},
            {name: "桥西直街", coords: [120.13887548415704, 30.318149800457245]},
            {name: "吴理人民俗艺术馆", coords: [120.13879651808642, 30.317601541818984]},
            {name: "桥头非遗美食", coords: [120.13886849212442, 30.31832744572055]},
            {name: "拱宸桥西侧凉亭", coords: [120.13884702238006, 30.317862801965727]},
            {name: "镇水神兽-蚣蝮（拱宸桥下）", coords: [120.1394105671555, 30.318225498705278]},
            {name: "拱宸桥上风景（面南）", coords: [120.13956388124979, 30.31814554807928]},
            {name: "拱宸桥上风景（面北）", coords: [120.13944900361878, 30.31816669095028]},
            {name: "镇水神兽-蚣蝮（桥西直街）", coords: [120.13864480875513, 30.316678580707144]},
            {name: "通益公纱厂旧址", coords: [120.13687724518397, 30.31789656464025]},
            {name: "活态馆展览—螺钿镶嵌", coords: [120.13811049527314, 30.318816844355737]},
            {name: "大运河东侧", coords: [120.140622064682, 30.318000123006282]},
            {name: "拱宸桥东侧-文物保护石碑", coords: [120.13990055747726, 30.318125666737227]},
            {name: "吉祥寺弄", coords: [120.13702752347415, 30.317998449494652]},
            {name: "桥西人家历史文化墙", coords: [120.1387875482328, 30.317631754173114]},
            {name: "万事利丝绸", coords: [120.13847064365451, 30.318223642798664]},
            {name: "拱宸桥水文站", coords: [120.13878684243542, 30.31767634580684]},
            {name: "国医馆-张仲景塑像", coords: [120.13866518172438, 30.316717433186987]},
            {name: "六贤记", coords: [120.13783443095997, 30.31830154129443]},
            {name: "浙江省第一盏电灯", coords: [120.13878684243542, 30.31767634580684]},
            {name: "西南财神端木赐", coords: [120.13864144947213, 30.317061074009573]},
            {name: "西路财神关羽", coords: [120.13864144947213, 30.317061074009573]},
            {name: "西北财神刘海蟾", coords: [120.13864144947213, 30.317061074009573]},
            {name: "东南财神范蠡", coords: [120.13864144947213, 30.317061074009573]},
            {name: "水上巴士码头", coords: [120.13956388124979, 30.31814554807928]},
            {name: "编织", coords: [120.13877549350661, 30.319096241662383]},
            {name: "风筝", coords: [120.13877549350661, 30.319096241662383]},
            {name: "陶艺生活馆", coords: [120.13988562572624, 30.31812719432141]},
            {name: "陶艺", coords: [120.13852588901617, 30.318982882313]},
            {name: "竹编", coords: [120.13870131395556, 30.317189980538387]}
        ];

        // 分类颜色
        const categoryColors = {
            '核心景点': '#FF6B6B',
            '博物馆/展览馆': '#4ECDC4',
            '手工艺/非遗': '#FFD166',
            '茶馆/书店': '#9D7BEF',
            '其他景点': '#06D6A0'
        };

        // 分类景点
        function categorizeAttraction(name) {
            if (name.includes('拱宸桥') || name.includes('大运河介绍') || name.includes('利泽千秋') || 
                name.includes('镇水神兽') || name.includes('水上巴士') || name.includes('码头') ||
                name.includes('通益公纱厂') || name.includes('中心集施') || name.includes('水文站') ||
                name.includes('财神') || name.includes('大运河东侧') || name.includes('文物保护石碑') ||
                name.includes('吉祥寺弄') || name.includes('桥西人家') || name.includes('六贤记') ||
                name.includes('浙江省第一盏电灯') || name.includes('国医馆-张仲景塑像')) {
                return '核心景点';
            } else if (name.includes('博物馆') || name.includes('展厅') || name.includes('展览') || 
                       name.includes('影像馆') || name.includes('艺术馆') || name.includes('美学馆') ||
                       name.includes('科普展厅')) {
                return '博物馆/展览馆';
            } else if (name.includes('织布') || name.includes('伞') || name.includes('布') || 
                       name.includes('陶艺') || name.includes('皮雕') || name.includes('木艺') || 
                       name.includes('泥塑') || name.includes('冷瓷') || name.includes('糕点') || 
                       name.includes('制香') || name.includes('杭绣') || name.includes('篆刻') || 
                       name.includes('编织') || name.includes('风筝') || name.includes('竹编') ||
                       name.includes('张小泉') || name.includes('活态馆') || name.includes('手工艺') ||
                       name.includes('非遗') || name.includes('铜艺') || name.includes('丝绸') ||
                       name.includes('螺钿镶嵌') || name.includes('过江布') || name.includes('油纸伞')) {
                return '手工艺/非遗';
            } else if (name.includes('茶馆') || name.includes('书屋') || name.includes('书') || 
                       name.includes('觅会') || name.includes('目茶') || name.includes('晓风')) {
                return '茶馆/书店';
            } else {
                return '其他景点';
            }
        }

        // 全局变量
        let map = null;
        let markers = [];
        let infoWindow = null;
        let useHighPrecision = true;

        // 处理坐标精度
        function processCoordinate(coord, precision = 6) {
            if (!useHighPrecision && precision < 14) {
                return [
                    parseFloat(coord[0].toFixed(precision)),
                    parseFloat(coord[1].toFixed(precision))
                ];
            }
            return coord;
        }

        // 初始化地图
        function initMap() {
            console.log("开始初始化地图...");
            
            // 检查API Key是否设置
            if (window.AMap && AMap.Map) {
                console.log("高德地图API v2.0加载成功");
            } else {
                console.error("高德地图API加载失败，请检查API Key");
                alert("地图API加载失败，请检查API Key设置");
                return;
            }
            
            // 创建地图实例 - 使用v2.0版本
            map = new AMap.Map('map', {
                zoom: 17, // 放大级别，更精确查看点位
                center: [120.139885, 30.318127],
                viewMode: '2D',
                mapStyle: 'amap://styles/normal'
            });

            console.log("地图实例创建成功");

            // 创建信息窗口
            infoWindow = new AMap.InfoWindow({
                offset: new AMap.Pixel(0, -30),
                autoMove: true,
                closeWhenClickMap: true
            });

            // 创建标记点
            markers = [];
            
            for (let i = 0; i < attractions.length; i++) {
                const attraction = attractions[i];
                const category = categorizeAttraction(attraction.name);
                const color = categoryColors[category] || '#06D6A0';
                
                // 处理坐标精度
                const processedCoords = processCoordinate(attraction.coords, 14);
                
                // 创建标记点
                const marker = new AMap.Marker({
                    position: processedCoords,
                    title: `${i + 1}. ${attraction.name}`,
                    content: `
                        <div style="background-color: ${color}; width: 18px; height: 18px; border-radius: 50%; 
                                    border: 2px solid white; box-shadow: 0 2px 6px rgba(0,0,0,0.3); cursor: pointer;
                                    display: flex; align-items: center; justify-content: center; color: white; font-size: 10px;
                                    font-weight: bold;" id="marker-${i}">
                            ${i + 1}
                        </div>`,
                    offset: new AMap.Pixel(-9, -9),
                    extData: {
                        index: i,
                        originalCoords: attraction.coords,
                        processedCoords: processedCoords
                    }
                });

                // 点击标记点显示信息窗口
                marker.on('click', function(e) {
                    const original = marker.getExtData().originalCoords;
                    const processed = marker.getExtData().processedCoords;
                    
                    infoWindow.setContent(`
                        <div class="info-window">
                            <div class="info-title">${attraction.name} (${i + 1})</div>
                            <div class="info-coords">
                                <div><strong>原始坐标:</strong></div>
                                <div>经度: ${original[0]}</div>
                                <div>纬度: ${original[1]}</div>
                                <div><strong>使用坐标:</strong></div>
                                <div>经度: ${processed[0].toFixed(14)}</div>
                                <div>纬度: ${processed[1].toFixed(14)}</div>
                                <div>分类: ${category}</div>
                            </div>
                        </div>
                    `);
                    infoWindow.open(map, marker.getPosition());
                    
                    // 高亮当前标记点
                    highlightMarker(i);
                    
                    // 高亮侧边栏对应项
                    highlightSidebarItem(i);
                });

                // 将标记点添加到地图
                map.add(marker);
                markers.push(marker);
            }

            console.log(`成功创建了 ${markers.length} 个标记点`);

            // 初始化侧边栏列表
            updateSidebarList(attractions);
            
            // 显示统计信息
            updateStatistics();
        }

        // 更新侧边栏列表
        function updateSidebarList(filteredAttractions) {
            const listElement = document.getElementById('list');
            listElement.innerHTML = '';
            
            filteredAttractions.forEach((attraction, index) => {
                const category = categorizeAttraction(attraction.name);
                const color = categoryColors[category] || '#06D6A0';
                const processedCoords = processCoordinate(attraction.coords, 14);
                
                const item = document.createElement('div');
                item.className = 'sidebar-item';
                item.style.borderLeftColor = color;
                item.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 4px;">${index + 1}. ${attraction.name}</div>
                    <div style="font-size: 11px; color: #666; display: flex; justify-content: space-between;">
                        <span>${category}</span>
                    </div>
                    <div class="coordinate-display">
                        经度: ${processedCoords[0].toFixed(10)}<br>
                        纬度: ${processedCoords[1].toFixed(10)}
                    </div>
                `;
                
                // 点击侧边栏项目，地图定位到该景点
                item.addEventListener('click', function() {
                    map.setCenter(processedCoords);
                    map.setZoom(19); // 放大到最大级别查看精度
                    
                    // 触发标记点的点击事件
                    if (markers[index]) {
                        markers[index].emit('click');
                    }
                });
                
                // 鼠标悬停效果
                item.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = '#f0f7ff';
                    this.style.transform = 'translateX(4px)';
                });
                
                item.addEventListener('mouseleave', function() {
                    this.style.backgroundColor = 'white';
                    this.style.transform = 'translateX(0)';
                });
                
                listElement.appendChild(item);
            });
            
            // 更新计数
            document.getElementById('count').textContent = filteredAttractions.length;
        }

        // 高亮标记点
        function highlightMarker(index) {
            // 恢复所有标记点的原始样式
            markers.forEach((marker, i) => {
                const category = categorizeAttraction(attractions[i].name);
                const color = categoryColors[category] || '#06D6A0';
                
                marker.setContent(`
                    <div style="background-color: ${color}; width: 18px; height: 18px; border-radius: 50%; 
                                border: 2px solid white; box-shadow: 0 2px 6px rgba(0,0,0,0.3); cursor: pointer;
                                display: flex; align-items: center; justify-content: center; color: white; font-size: 10px;
                                font-weight: bold;" id="marker-${i}">
                        ${i + 1}
                    </div>`);
            });
            
            // 高亮当前标记点
            if (markers[index]) {
                const category = categorizeAttraction(attractions[index].name);
                const color = categoryColors[category] || '#06D6A0';
                
                markers[index].setContent(`
                    <div style="background-color: ${color}; width: 24px; height: 24px; border-radius: 50%; 
                                border: 3px solid #FFD700; box-shadow: 0 0 15px rgba(255, 215, 0, 0.8); cursor: pointer;
                                display: flex; align-items: center; justify-content: center; color: white; font-size: 12px;
                                font-weight: bold;" id="marker-${index}">
                        ${index + 1}
                    </div>`);
            }
        }

        // 高亮侧边栏项目
        function highlightSidebarItem(index) {
            const items = document.querySelectorAll('.sidebar-item');
            items.forEach((item, i) => {
                if (i === index) {
                    item.style.boxShadow = '0 0 0 2px rgba(255, 215, 0, 0.5)';
                    item.style.backgroundColor = '#fffde7';
                    item.style.fontWeight = 'bold';
                } else {
                    item.style.boxShadow = 'none';
                    item.style.backgroundColor = 'white';
                    item.style.fontWeight = 'normal';
                }
            });
        }

        // 更新统计信息
        function updateStatistics() {
            const categories = {};
            attractions.forEach(attraction => {
                const category = categorizeAttraction(attraction.name);
                categories[category] = (categories[category] || 0) + 1;
            });
            
            let statsHTML = '<strong>景点分类统计:</strong><br>';
            for (const [category, count] of Object.entries(categories)) {
                const color = categoryColors[category] || '#06D6A0';
                statsHTML += `<span style="color:${color}">● ${category}: ${count}个</span><br>`;
            }
            
            statsHTML += `<br><strong>坐标精度:</strong> ${useHighPrecision ? '高精度(14位)' : '标准(6位)'}<br>`;
            statsHTML += '<br><strong>地图操作:</strong><br>';
            statsHTML += '1. 点击地图标记点查看详情<br>';
            statsHTML += '2. 点击侧边栏项目定位景点<br>';
            statsHTML += '3. 使用搜索框快速查找景点<br>';
            statsHTML += '4. 使用"调整坐标精度"按钮切换精度';
            
            document.getElementById('stats').innerHTML = statsHTML;
        }

        // 调整坐标精度
        function adjustPrecision() {
            useHighPrecision = !useHighPrecision;
            
            // 重新创建所有标记点
            markers.forEach(marker => {
                map.remove(marker);
            });
            
            markers = [];
            
            for (let i = 0; i < attractions.length; i++) {
                const attraction = attractions[i];
                const category = categorizeAttraction(attraction.name);
                const color = categoryColors[category] || '#06D6A0';
                
                // 处理坐标精度
                const processedCoords = processCoordinate(attraction.coords, useHighPrecision ? 14 : 6);
                
                // 创建标记点
                const marker = new AMap.Marker({
                    position: processedCoords,
                    title: `${i + 1}. ${attraction.name}`,
                    content: `
                        <div style="background-color: ${color}; width: 18px; height: 18px; border-radius: 50%; 
                                    border: 2px solid white; box-shadow: 0 2px 6px rgba(0,0,0,0.3); cursor: pointer;
                                    display: flex; align-items: center; justify-content: center; color: white; font-size: 10px;
                                    font-weight: bold;" id="marker-${i}">
                            ${i + 1}
                        </div>`,
                    offset: new AMap.Pixel(-9, -9),
                    extData: {
                        index: i,
                        originalCoords: attraction.coords,
                        processedCoords: processedCoords
                    }
                });

                // 点击标记点显示信息窗口
                marker.on('click', function(e) {
                    const original = marker.getExtData().originalCoords;
                    const processed = marker.getExtData().processedCoords;
                    
                    infoWindow.setContent(`
                        <div class="info-window">
                            <div class="info-title">${attraction.name} (${i + 1})</div>
                            <div class="info-coords">
                                <div><strong>原始坐标:</strong></div>
                                <div>经度: ${original[0]}</div>
                                <div>纬度: ${original[1]}</div>
                                <div><strong>使用坐标:</strong></div>
                                <div>经度: ${processed[0].toFixed(14)}</div>
                                <div>纬度: ${processed[1].toFixed(14)}</div>
                                <div>分类: ${category}</div>
                            </div>
                        </div>
                    `);
                    infoWindow.open(map, marker.getPosition());
                    
                    // 高亮当前标记点
                    highlightMarker(i);
                    
                    // 高亮侧边栏对应项
                    highlightSidebarItem(i);
                });

                // 将标记点添加到地图
                map.add(marker);
                markers.push(marker);
            }
            
            updateStatistics();
            alert(`已切换到${useHighPrecision ? '高精度(14位)' : '标准精度(6位)'}模式`);
        }

        // 搜索功能
        function searchAttractions(keyword) {
            const filtered = attractions.filter(attraction => 
                attraction.name.toLowerCase().includes(keyword.toLowerCase())
            );
            
            updateSidebarList(filtered);
            
            // 隐藏所有标记点
            markers.forEach(marker => {
                marker.hide();
            });
            
            // 显示筛选后的标记点
            filtered.forEach(attraction => {
                const index = attractions.findIndex(a => a.name === attraction.name);
                if (index !== -1 && markers[index]) {
                    markers[index].show();
                }
            });
            
            // 如果有关键词，调整视图以显示所有结果
            if (keyword && filtered.length > 0) {
                const bounds = new AMap.Bounds();
                filtered.forEach(attraction => {
                    bounds.extend(processCoordinate(attraction.coords, 14));
                });
                map.setBounds(bounds);
            }
        }

        // 显示所有景点标记
        function showAllMarkers() {
            markers.forEach(marker => {
                marker.show();
            });
            updateSidebarList(attractions);
        }

        // 导出数据为JSON
        function exportData() {
            // 创建格式化的JSON数据
            const exportData = attractions.map((att, index) => ({
                序号: index + 1,
                景点名称: att.name,
                原始经度: att.coords[0],
                原始纬度: att.coords[1],
                使用经度: processCoordinate(att.coords, 14)[0],
                使用纬度: processCoordinate(att.coords, 14)[1],
                类别: categorizeAttraction(att.name)
            }));
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `拱宸桥景点数据_${useHighPrecision ? '高精度' : '标准'}.json`;
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM加载完成，开始初始化地图...");
            
            try {
                initMap();
                
                // 绑定搜索功能
                document.getElementById('searchInput').addEventListener('input', function(e) {
                    searchAttractions(e.target.value);
                });
                
                // 绑定重置视图按钮
                document.getElementById('resetView').addEventListener('click', function() {
                    map.setZoom(17);
                    map.setCenter([120.139885, 30.318127]);
                    showAllMarkers();
                    document.getElementById('searchInput').value = '';
                });
                
                // 绑定显示所有景点按钮
                document.getElementById('showAllMarkers').addEventListener('click', showAllMarkers);
                
                // 绑定调整精度按钮
                document.getElementById('adjustPrecision').addEventListener('click', adjustPrecision);
                
                // 绑定导出数据按钮
                document.getElementById('exportData').addEventListener('click', exportData);
                
                console.log("地图初始化完成！");
            } catch (error) {
                console.error("地图初始化失败:", error);
                alert("地图初始化失败: " + error.message);
            }
        });
    </script>
</body>
</html>